<!doctype html>
<html lang="en" itemscope itemtype="http://schema.org/Person">
<head>
            <meta charset="utf-8">
        <!-- Site Meta Data -->
        <title>Automatically route VPN traffic (split tunnelling)</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Shane Maloney">

        <link rel="shortcut icon" href="">

        <!-- schema.org -->
        <meta itemprop="name" content="samaloney">
        <meta itemprop="image" content="https://pbs.twimg.com/profile_images/879771897650479104/IW1qXFlU_400x400.jpg">
        <meta itemprop="description" content="">

        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>
        <!-- Style Meta Data -->
        <link rel="stylesheet" href="http://samaloney.com/theme/css/style.css" type="text/css"/>
        <link rel="stylesheet" href="http://samaloney.com/theme/css/pygments.css" type="text/css"/>

        <!-- Feed Meta Data -->
            <link href="http://samaloney.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
                  title="samaloney ATOM Feed"/>

        <!-- Twitter Feed -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="samaloney">
        <meta name="twitter:image" content="">

    <meta name="twitter:creator" content="samaloney">
    <meta name="twitter:url" content="http://samaloney.com/automatically-route-vpn-traffic-split-tunnelling.html">
    <meta name="twitter:title" content="samaloney ~ Automatically route VPN traffic (split tunnelling)">
    <meta name="twitter:description" content="Route traffic over VPN based on destination IP">

    <!-- Facebook Meta Data -->
    <meta property="og:title" content="samaloney ~ Automatically route VPN traffic (split tunnelling)"/>
    <meta property="og:description" content="Route traffic over VPN based on destination IP"/>
    <meta property="og:image" content=""/>
</head>

<body>
<!-- Sidebar -->
<aside>
    <center><a href="http://samaloney.com"><img id="avatar" src="https://pbs.twimg.com/profile_images/879771897650479104/IW1qXFlU_400x400.jpg"></a></center>
    <h1>samaloney</h1>
        <p>Solar Physics, Programming, Technology</p>
    <br>

        <a class="twitter-follow-button"
           href="https://twitter.com/samaloney"
           data-show-count="false"
           data-lang="en">
            Follow @twitterdev
        </a>
        <script type="text/javascript">
            window.twttr = (function (d, s, id) {
                var t, js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s);
                js.id = id;
                js.src = "https://platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js, fjs);
                return window.twttr || (t = {
                        _e: [], ready: function (f) {
                            t._e.push(f)
                        }
                    });
            }(document, "script", "twitter-wjs"));
        </script>

    <nav class="nav">
        <ul class="list-bare">

                <li><a class="nav__link" href="http://samaloney.com">Home</a></li>
                <li><a class="nav__link" href="http://samaloney.com/category/blog.html">Blog</a></li>

                <li><a class="nav__link" href="http://samaloney.com/pages/about.html">About</a></li>
                <li><a class="nav__link" href="http://samaloney.com/pages/publications.html">Publications</a></li>

        </ul>
    </nav>

    <p class="social">
                <a href="https://www.linkedin.com/in/samaloney" target="_blank"><img
                        src="http://samaloney.com/theme/images/icons/linkedin.png"></a>
                <a href="https://github.com/samaloney" target="_blank"><img
                        src="http://samaloney.com/theme/images/icons/github.png"></a>
                <a href="https://twitter.com/samaloney" target="_blank"><img
                        src="http://samaloney.com/theme/images/icons/twitter.png"></a>
            <a href="http://samaloney.com/feeds/all.atom.xml" rel="alternate">
                <img src="http://samaloney.com/theme/images/icons/rss.png"></a>
    </p>

        <h2>Categories</h2>
        <ul class="navbar">
                <li><a
                        href="http://samaloney.com/category/blog.html">Blog</a></li>
                <li class="active"><a
                        href="http://samaloney.com/category/how-to.html">How To</a></li>
        </ul>

        <h2 class="blog_roll_link"><br/>BLOGROLLS</h2>
        <ul class="navbar">
                <li><a href="http://sunpy.org/">SunPy</a></li>
                <li><a href="http://github.com/sunpy/xrayvision">xrayvision</a></li>
                <li><a href="http://www.tcd.ie/Physics/research/themes/astrophysics/">TCD Astro</a></li>
        </ul>

</aside>

<!-- Content -->
<article>
    <section id="content">
        <article>
            <h2 class="post_title post_detail"><a href="http://samaloney.com/automatically-route-vpn-traffic-split-tunnelling.html" rel="bookmark"
                                                  title="Permalink to Automatically route VPN traffic (split tunnelling)">Automatically route VPN traffic (split tunnelling)</a></h2>
            <div class="entry-content blog-post">
                <p>When using VPNs to access remote systems I often need to access local network resources as well additional so remote systems do not have internet access. A pretty simple solution is to create a specific routes when the VPN is created. As the most specific route is used only traffic for this network will be forwarded over the VPN tunnel, the rest will use the default route. The <code>if-up</code> and <code>if-down</code> scripts located at <code>/etc/ppp/</code> are called with when a ppp conection is created or ended. The following arguments: <code>interface-name, tty-device, speed, local-IP-address, remote-IP-address, ipparam</code> are passed to these scripts so we can use these to add/remove specific rules for specify networks.</p>
<div class="highlight"><pre><span></span><span class="c1">#/etc/ppp/if-up</span>

<span class="c1">#!/bin/evn bash</span>

<span class="nv">IFNAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">LOCALIP</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">4</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">REMOTEIP</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">5</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">REMOTEIP</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;192.0.2.1&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  /sbin/route add -host lab_computer.foo -interface <span class="s2">&quot;</span><span class="si">${</span><span class="nv">IFNAME</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">fi</span>
</pre></div>


<div class="highlight"><pre><span></span>#/etc/ppp/if-down

#!/bin/env bash

IFNAME=&quot;<span class="cp">${</span><span class="mi">1</span><span class="cp">}</span>&quot;
LOCALIP=&quot;<span class="cp">${</span><span class="mi">4</span><span class="cp">}</span>&quot;
REMOTEIP=&quot;<span class="cp">${</span><span class="mi">5</span><span class="cp">}</span>&quot;

if [[ &quot;<span class="cp">${</span><span class="n">REMOTEIP</span><span class="cp">}</span>&quot; == &quot;192.0.2.1&quot; ]]; then
  /sbin/route delete -host lab_computer.foo -interface &quot;<span class="cp">${</span><span class="n">IFNAME</span><span class="cp">}</span>&quot;
fi
</pre></div>
            </div>
            <div class="post_list">
                <span>By </span>
                <a href="http://samaloney.com/author/shane-maloney.html">@Shane Maloney</a>
                <span> in </span>
                <span class="post_category"><a href="http://samaloney.com/category/how-to.html" rel="bookmark"
                                               title="Permalink to How To">[ How To ]</a></span>
                <span class="post_date">Sat 26 March 2016</span>
                <div><span>Tags : </span>
                            <span><a href="http://samaloney.com/tag/osx.html">#osx, </a></span>
                            <span><a href="http://samaloney.com/tag/linux.html">#linux, </a></span>
                            <span><a href="http://samaloney.com/tag/networking.html">#networking, </a></span>
                            <span><a href="http://samaloney.com/tag/vpn.html">#vpn, </a></span>
                </div>

                <div class="entry-social">
                    <span class="twitter"><a target="_blank" rel="nofollow"
                                             onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=700');return false;"
                                             title="Twitter"
                                             href="https://twitter.com/share?url=http://samaloney.com/automatically-route-vpn-traffic-split-tunnelling.html&text=Automatically route VPN traffic (split tunnelling)&via=samaloney"><img
                            src="http://samaloney.com/theme/images/icons/twitter-s.png"></a></span>

                    <span class="gplus"><a target="_blank" title="Google +"
                                           href="https://plus.google.com/share?url=http://samaloney.com/automatically-route-vpn-traffic-split-tunnelling.html&hl=fr"
                                           rel="nofollow"
                                           onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img
                            src="http://samaloney.com/theme/images/icons/google-s.png"></a></span>

                    <span class="facebook"><a target="_blank" title="Facebook" rel="nofollow"
                                              onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700');return false;"
                                              href="https://www.facebook.com/sharer.php?u=http://samaloney.com/automatically-route-vpn-traffic-split-tunnelling.html&t=Automatically route VPN traffic (split tunnelling)"><img
                            src="http://samaloney.com/theme/images/icons/facebook-s.png"></a></span>

                    <a target="_blank" title="Linkedin"
                       href="https://www.linkedin.com/shareArticle?mini=true&url=http://samaloney.com/automatically-route-vpn-traffic-split-tunnelling.html&title=Automatically route VPN traffic (split tunnelling)"
                       rel="nofollow"
                       onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img
                            src="http://samaloney.com/theme/images/icons/linkedin-s.png"></a>

                    <span class="mail"><a
                            href="mailto:?subject=Automatically route VPN traffic (split tunnelling)&amp;body=Viens découvrir un article à propos de [Automatically route VPN traffic (split tunnelling)] sur le site de Shane Maloney. http://samaloney.com/automatically-route-vpn-traffic-split-tunnelling.html"
                            title="Share by Email" target="_blank"><img
                            src="http://samaloney.com/theme/images/icons/mail-s.png"></a></span>
                </div>
            </div>
        </article>
    </section>
</article>

<!-- Footer -->


</body>
</html>